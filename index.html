<!DOCTYPE html>
<html>
<head>
<title>Proximity Chat</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial, sans-serif;
  margin:0;
  padding:20px;
}

h1{text-align:center}

#login{
  max-width:400px;
  margin:30px auto;
  background:#1a1a1a;
  padding:20px;
  border-radius:12px;
  text-align:center;
}

input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#333;
  color:white;
}

button{
  width:100%;
  padding:14px;
  margin-top:15px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}

#joinBtn{background:#4caf50}

.dimensions{
  display:none;
  gap:20px;
  max-width:1200px;
  margin:30px auto;
}

@media(min-width:800px){
  .dimensions{display:flex}
}

.dimension{
  flex:1;
  padding:15px;
  border-radius:14px;
}

.overworld{background:#1f6f5f}
.nether{background:#7a1f1f}
.end{background:#4b2a6f}

.dimension button{
  background:white;
  color:black;
  margin-top:10px;
}

#players{
  max-width:500px;
  margin:30px auto;
  background:#1a1a1a;
  padding:15px;
  border-radius:12px;
}

.player{
  background:#2a2a2a;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
}
</style>
</head>

<body>

<h1>Proximity Chat</h1>

<div id="login">
  <input id="usernameInput" placeholder="Minecraft Username">
  <input id="passwordInput" type="password" placeholder="Room password">
  <button id="joinBtn">Join Server</button>
</div>

<div class="dimensions" id="dimensions">
  <div class="dimension overworld">
    <h2>Overworld</h2>
    <button onclick="joinGroup('Overworld',1)">Group 1</button>
    <button onclick="joinGroup('Overworld',2)">Group 2</button>
    <button onclick="joinGroup('Overworld',3)">Group 3</button>
  </div>

  <div class="dimension nether">
    <h2>Nether</h2>
    <button onclick="joinGroup('Nether',1)">Group 1</button>
    <button onclick="joinGroup('Nether',2)">Group 2</button>
    <button onclick="joinGroup('Nether',3)">Group 3</button>
  </div>

  <div class="dimension end">
    <h2>End</h2>
    <button onclick="joinGroup('End',1)">Group 1</button>
    <button onclick="joinGroup('End',2)">Group 2</button>
    <button onclick="joinGroup('End',3)">Group 3</button>
  </div>
</div>

<div id="players">
  <strong>Players in group</strong>
  <div id="playerList">Not in a group</div>
</div>

<script>
const ROOM_PASSWORD = "BMS Minecraft";

firebase.initializeApp({
  apiKey: "AIzaSyCR0kIMG1QJzWMUh52UYduYoL9a-f_Db-w",
  authDomain: "proximity-chat-95107.firebaseapp.com",
  databaseURL: "https://proximity-chat-95107-default-rtdb.firebaseio.com",
  projectId: "proximity-chat-95107"
});

const db = firebase.database();

let username = "";
let currentPath = "";
let listener = null;

joinBtn.onclick = () => {
  if (passwordInput.value !== ROOM_PASSWORD) {
    alert("Wrong password");
    return;
  }

  username = usernameInput.value.trim();
  if (!username) {
    alert("Enter username");
    return;
  }

  login.style.display = "none";
  dimensions.style.display = "flex";
};

function leaveGroup(){
  if(!currentPath) return;
  db.ref(currentPath + "/" + username).remove();
  if(listener) db.ref(currentPath).off("value", listener);
}

function joinGroup(dim, group){
  leaveGroup();

  currentPath = `groups/${dim}/${group}`;
  const myRef = db.ref(currentPath + "/" + username);
  myRef.set(true);
  myRef.onDisconnect().remove();

  playerList.innerHTML = "Loading players...";

  listener = db.ref(currentPath).on("value", snap => {
    const players = snap.val() || {};
    playerList.innerHTML = "";
    Object.keys(players).forEach(name => {
      const div = document.createElement("div");
      div.className = "player";
      div.textContent = name + (name === username ? " (You)" : "");
      playerList.appendChild(div);
    });
  });
}
</script>

</body>
</html>
